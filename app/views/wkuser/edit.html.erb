<%= javascript_include_tag 'wkuser', :plugin => "redmine_wktime" %>
<h2><%= l(:label_employee) %></h2>
<%
	roleObj = Role.order(:name)
	roleArr = nil
	roleArr = roleObj.pluck(:name, :id)
	genderHash = {'M' => "#{l(:gender_hash_male)}", 'F' => "#{l(:gender_hash_female)}", 'O' => "#{l(:gender_hash_others)}"}
	locationArr = nil
	locationobj = WkLocation.order(:name)
	locationArr = locationobj.pluck(:name, :id)
	departmentArr = WkCrmEnumeration.where(:enum_type => 'DP').order(:name).pluck(:name, :id)
	maritalArr = WkCrmEnumeration.where(:enum_type => 'MS').order(:name).pluck(:name, :id)
	emergContactTypeArr = WkCrmEnumeration.where(:enum_type => 'EC').order(:name).pluck(:name, :id)
	dept_section_arr = WkCrmEnumeration.where(:enum_type => 'DS').order(:position).pluck(:name, :id)
	shiftArr = nil
	shiftObj = WkShift.where(:in_active => true, :is_schedulable => true).order(:name)
	shiftArr = shiftObj.pluck(:name, :id)
	shiftArr.unshift(["",''])
	parentArr = []
	cond = "lft >= #{@user.user.lft} and rgt <= #{@user.user.rgt}"
	parentObj = User.where.not(cond).order('firstname')
	parentArr = parentObj.collect {|t| ["#{t.firstname + ' ' + t.lastname}", t.id] }
	parentArr.unshift(["",''])
%>
<table>
    <tr>
        <th align="left"><%=l(:field_user)%> :</th>
        <td><%=h @user.user.name %></td>
    </tr>
</table>
<br />
<%= form_with model: @user, method: "post", url: {action: "save"} do |f| %>
<div>
    <div class="splitcontent">
        <div class="splitcontentleft">
            <fieldset class="box tabular">
                <legend><%=l(:label_employee)%> <%=l(:label_details)%></legend>
                <p><label><b><%= l(:label_ftte_supervisor) %></b></label><%= f.select :parent_id, options_for_select(parentArr, selected: @user.user.parent_id || '') %></p>
                <%= labelled_fields_for :erpmineuser, @user do |user_fields| %>
                <%= user_fields.hidden_field "id" %>
                <%= user_fields.hidden_field "user_id" %>
                <p><%= user_fields.date_field :join_date %></p>
                <%= calendar_for('erpmine_join_date') %>
                <p><%= user_fields.date_field :termination_date %></p>
                <%= calendar_for('erpmine_termination_date') %>
                <p><%= user_fields.date_field :birth_date %></p>
                <%= calendar_for('erpmine_birth_date') %>
                <p><%= user_fields.select :role_id, roleArr, {} %></p>
                <p><%= user_fields.select :gender, genderHash.invert, {} %></p>
                <p><%= user_fields.select :marital_id, maritalArr, {label:l(:label_marital_status)} %></p>
                <p><%= user_fields.text_field :emergency_contact %></p>
                <p><%= user_fields.select :emerg_type_id, emergContactTypeArr, {label:l(:label_emerg_contact_type)} %></p>
                <p><%= user_fields.text_field :employee_id, label:l(:label_employee_id) %></p>
                <p><%= user_fields.text_field :state_insurance, label:l(:label_state_insurance) %></p>

                <p><%= user_fields.select :location_id, locationArr, {} %></p>
                <p><%= user_fields.select :department_id, departmentArr, {} %></p>
                <p><%= user_fields.select :dept_section_id, dept_section_arr, {label:l(:label_dept_section)} %></p>
                <p><%= user_fields.check_box :is_schedulable %></p>
                <p><%= user_fields.select :shift_id, shiftArr, {} %></p>
                <p><%= user_fields.text_field :bank_name %></p>
                <% if !@user&.user&.id&.present? %>
                <p><%= user_fields.text_field :account_number %></p>
                <% else %>
                <p>
                    <%= user_fields.text_field :account_number, :value => @user&.account_number.present? ? WkUser.showEncryptdData(@user&.user&.id, 'account_number') : '' %>
                    <%= link_to image_tag('withoutcommant.png', plugin: "redmine_wktime"), "javascript: showDetails('#{@user&.user&.id}', '#{'account_number'}', '#{l(:label_account_number)}', #{false});" %>
                </p>
                <% end %>
                <p><%= user_fields.text_field :bank_code %></p>
                <% if !@user&.user&.id&.present? %>
                <p><%= user_fields.text_field :tax_id %></p>
                <% else %>
                <p>
                    <%= user_fields.text_field :tax_id, :value => @user&.tax_id.present? ? WkUser.showEncryptdData(@user&.user&.id, 'tax_id') : '' %>
                    <%= link_to image_tag('withoutcommant.png', plugin: "redmine_wktime"), "javascript: showDetails('#{@user&.user&.id}', '#{'tax_id'}', '#{l(:field_tax)}', #{false});"%>
                </p>
                <% end %>
                <% if !@user&.user&.id&.present? %>
                <p><%= user_fields.text_field :ss_id %></p>
                <% else %>
                <p>
                    <%= user_fields.text_field :ss_id, :value => @user&.ss_id.present? ? WkUser.showEncryptdData(@user&.user&.id, 'ss_id') : '' %>
                    <%= link_to image_tag('withoutcommant.png', plugin: "redmine_wktime"), "javascript: showDetails('#{@user&.user&.id}', '#{'ss_id'}',  '#{l(:field_ss)}', #{false});" %>
                </p>
                <% end %>
                <p><%= user_fields.text_field :retirement_account, label:l(:field_retirement_account) %></p>
                <p><%= user_fields.text_area :notes %></p>
                <p><%= user_fields.text_field :id1 %></p>
                <p><%= user_fields.text_field :id2 %></p>
                <p><%= user_fields.text_field :id3 %></p>
                <p><%= user_fields.text_field :custom_number1 %></p>
                <p><%= user_fields.text_field :custom_number2 %></p>
                <p><%= user_fields.date_field :custom_date1 %></p>
                <%= calendar_for('erpmine_custom_date1') %>
                <p><%= user_fields.date_field :custom_date2 %></p>
                <%= calendar_for('erpmine_custom_date2') %>
                <% end %>
            </fieldset>
        </div>
        <div class="splitcontentright">
            <% addressObj = @user.address %>
            <%=h hidden_field_tag('address_id', (@user.blank? ? "" : @user.address_id) ) %>
            <%= render partial: "wklead/contact_info", locals: { address: addressObj, disable: false }%>
            <%= hidden_field_tag "attachment_ids", "" %>
            <%= labelled_fields_for :erpmineuser, @user do |f| %>
            <%= f.hidden_field "source_type" %>
            <%= f.hidden_field "source_id" %>
            <% end %>
            <%= render partial: "wkdocument/attachment_form", locals: { container: @user.user, container_type: "Principal", editable: true, deletable: true, hideImage: true } %>
        </div>
    </div>
</div>
<div style="clear:left;"></div>
<%= f.submit "Save" %>
<% end %>

<div id="user-dlg"></div>